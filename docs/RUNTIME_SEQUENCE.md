# ๐ค MEDIBOT - Internal Runtime Sequence
## ุงูุชุณูุณู ุงูุฏุงุฎูู ููุธุงู ุตุฑู ุงูุฏูุงุก ุงูุขูู

**ุงูุฅุตุฏุงุฑ:** 1.0  
**ุงูุชุงุฑูุฎ:** 2026-01-31  
**ููุน ุงููุซููุฉ:** ุชูุซูู ุชููู ููุชุณูุณู ุงูุฏุงุฎูู

---

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐู ุงููุซููุฉ ุชุตู ุงูุชุณูุณู ุงูุฏุงุฎูู ุงููุงูู ูู ุญุงูุฉ ุงูุงูุชุธุงุฑ (IDLE) ุฅูู ุตุฑู ุงูุฏูุงุก ูุงูุนูุฏุฉ ุฅูู ุงูุงูุชุธุงุฑ.

---

## ๐น ุงููุฑุญูุฉ 0: IDLE (ุงูุงูุชุธุงุฑ)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- ุงููุธุงู ูู ูุถุน ุงูุชุธุงุฑ ูุงูู
- `robot_state = IDLE`
- ุฌููุน ุงูุณูุฑูููุงุช ูุชูููุฉ (PWM = 0)
- ุงููุงููุฑุง ูุบููุฉ (`camera.is_running() = False`)
- ุงููุงุฑูุณูู ูู ูุถุน ุงูุตูุฑ (`current_carousel_angle = 0ยฐ`)
- ุงููุญุฑูุงุช ูุชูููุฉ

**ุงูุดุฑุท ููุฏุฎูู:**
- ุงููุธุงู ุจุฏุฃ ุญุฏูุซุงู
- ุฃู ุงูุชูุช ุนูููุฉ ุตุฑู ุณุงุจูุฉ

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
- `scheduler_loop` ูุนูู ูู ุงูุฎูููุฉ
- ูุญุต ุงูููุช ุงูุญุงูู ูู ุซุงููุฉ
- ููุงุฑูุฉ ุงูููุช ูุน ุฌุฏุงูู ุงูุตูุงุฏูู

**ุงูุชุญูู/ุงูุฃูุงู:**
- ูุง ุชูุฌุฏ ุญุฑูุฉ ูููุงููููุฉ
- ุงูุทุงูุฉ ูู ูุถุน ุชูููุฑ

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- `time_diff <= 65` (ูุจู 60 ุซุงููุฉ ูู ููุนุฏ ุงูุฌุฑุนุฉ)

---

## ๐น ุงููุฑุญูุฉ 1: CAMERA_WARMUP (ุชุณุฎูู ุงููุงููุฑุง)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- `time_diff` ุจูู 55-65 ุซุงููุฉ ูุจู ุงูููุนุฏ
- `pre_notified[camera_key] != current_date_key`

**ุงูุดุฑุท ููุฏุฎูู:**
- ุงูุชุฑุงุจ ููุนุฏ ุฌุฑุนุฉ ูุฌุฏููุฉ (T - 60 ุซุงููุฉ)

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
1. ุชุดุบูู ุตูุช ุชูุจูู ุงููุงููุฑุง (`SOUND_CAMERA`)
2. ุงุณุชุฏุนุงุก `camera.start()`
3. ุชุญููู Face Engine ูู ุงูุฎูููุฉ
4. ุถุจุท ุฅุนุฏุงุฏุงุช ุงููุงููุฑุง (Exposure, ISO)
5. ุชุณุฌูู `camera_started_key` ูููุน ุงูุชูุฑุงุฑ

**ุงูุชุญูู/ุงูุฃูุงู:**
- ุงูุชุญูู ูู `camera.is_running()` ูุจู ุงูุจุฏุก
- ูุนุงูุฌุฉ ุงูุฎุทุฃ ุฅุฐุง ูุดู ุงูุชุดุบูู

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- `time_diff <= 35` (ูุจู 30 ุซุงููุฉ ูู ุงูููุนุฏ)

---

## ๐น ุงููุฑุญูุฉ 2: PRE_NOTIFY (ุงูุชูุจูู ุงููุณุจู)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- `time_diff` ุจูู 25-35 ุซุงููุฉ ูุจู ุงูููุนุฏ
- `pre_notified[box_id] != current_date_key`

**ุงูุดุฑุท ููุฏุฎูู:**
- ุงูุชุฑุงุจ ููุนุฏ ุงูุฌุฑุนุฉ (T - 30 ุซุงููุฉ)

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
1. ุชุดุบูู ุตูุช ุงูุชูุจูู ุงููุณุจู (`SOUND_PRE_NOTIFY`)
2. ุทุจุงุนุฉ ุฑุณุงูุฉ ููุณุฌูุงุช
3. ุชุณุฌูู `pre_notified[box_id]` ูููุน ุงูุชูุฑุงุฑ

**ุงูุชุญูู/ุงูุฃูุงู:**
- ูุง ุชููุฐ ุฅุฐุง ุชู ุงูุชูุจูู ูุณุจูุงู ูููุณ ุงูููุนุฏ

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- `current_hour == target_hour AND current_minute == target_minute`

---

## ๐น ุงููุฑุญูุฉ 3: MOVE_FORWARD (ุงูุชุญุฑู ููุฃูุงู)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- ุญุงู ููุช ุงูุฌุฑุนุฉ ุจุงูุถุจุท
- `last_dispensed[box_id] != current_date_key`

**ุงูุดุฑุท ููุฏุฎูู:**
- ุงูููุช ุงูุญุงูู = ููุช ุงูุฌุฑุนุฉ ุงููุณุชูุฏู
- ูู ูุชู ุตุฑู ูุฐู ุงูุฌุฑุนุฉ ูุณุจูุงู

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
1. ุงุณุชุฏุนุงุก `full_dispense_sequence(box_id)`
2. ุฅุฑุณุงู ุฃูุฑ `START` ููู Arduino ุนุจุฑ Serial
3. ุชุญุฑูู ุงูุฑูุจูุช ููุฃูุงู
4. ุงูุชุธุงุฑ `ROBOT_FORWARD_TIME = 8` ุซูุงูู
5. ุฅุฑุณุงู ุฃูุฑ `STOP` ููู Arduino

**ุงูุฃูุงูุฑ ุงููููุงููููุฉ:**
- `serial.write("START\n")` โ ุชุดุบูู ุงููุญุฑูุงุช ููุฃูุงู
- `serial.write("STOP\n")` โ ุฅููุงู ุงููุญุฑูุงุช

**ุงูุชุญูู/ุงูุฃูุงู:**
- Arduino ูุฑุงูุจ ุงูุนูุงุฆู ุจุงูู Ultrasonic
- ุฅุฐุง ูุงู `distance < 20cm` โ ุชููู ุชููุงุฆู

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- ุงูุชูุงุก `ROBOT_FORWARD_TIME`

---

## ๐น ุงููุฑุญูุฉ 4: ARRIVED_AT_PATIENT (ุงููุตูู ูููุฑูุถ)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- ุงูุฑูุจูุช ุชููู ุนูุฏ ุงููุฑูุถ

**ุงูุดุฑุท ููุฏุฎูู:**
- ุงูุชูุงุก ุญุฑูุฉ ุงูุฑูุจูุช ููุฃูุงู

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
1. ุฅุฑุณุงู ุฃูุฑ `STOP` ููุชุฃููุฏ
2. ุงูุชุธุงุฑ ุชุซุจูุช `ROBOT_SETTLE_TIME = 1` ุซุงููุฉ
3. ูุฑุงุกุฉ ุฅุนุฏุงุฏ `auth_enabled` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุชุญูู/ุงูุฃูุงู:**
- ุงูุชุฃูุฏ ูู ุชููู ุงููุญุฑูุงุช ุจุงููุงูู
- ููุน ุฃู ุญุฑูุฉ ูุจู ุงูุชุญูู

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- **ุฅุฐุง `auth_enabled = True`:** โ ุงูุชูุงู ุฅูู `VERIFY_FACE`
- **ุฅุฐุง `auth_enabled = False`:** โ ุงูุชูุงู ูุจุงุดุฑ ุฅูู `DISPENSE`

---

## ๐น ุงููุฑุญูุฉ 5A: VERIFY_FACE (ุงูุชุญูู ูู ุงููุฌู) [ุดุฑุทู]

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- `auth_enabled = True`
- ุงููุงููุฑุง ุชุนูู
- Face Engine ูุญููู

**ุงูุดุฑุท ููุฏุฎูู:**
- ูุธุงู ุงูุชุญูู ููุนูู
- ุงูุฑูุจูุช ูุงุตู ูููุฑูุถ

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
1. ุงุณุชุฏุนุงุก `verify_face_with_timeout(15)`
2. ุญููุฉ ูุญุต ูู ุซุงููุฉ ููุฏุฉ 15 ุซุงููุฉ
3. ุงุณุชุฏุนุงุก `get_last_face()` ููุญุตูู ุนูู ุขุฎุฑ ูุฌู ูุนุฑูู
4. ุงูุชุญูู ูู:
   - `name != "Unknown"`
   - `(time.time() - face_time) < 5` (ุฑูุตุฏ ุญุฏูุซุงู)

**ุงูุชูุฑุนุงุช ุงูุดุฑุทูุฉ:**

| ุงููุชูุฌุฉ | ุงูุฅุฌุฑุงุก |
|---------|---------|
| โ ูุฌุงุญ ุงูุชุญูู | ุทุจุงุนุฉ ุงุณู ุงูุดุฎุต + ุงูุงูุชูุงู ูู `DISPENSE` |
| โ Timeout (15s) | ุทุจุงุนุฉ "ุงูุชูุช ุงููููุฉ" + ุงูุงูุชูุงู ูู `RETURN_HOME` |
| โ ูุฌู ุบูุฑ ูุนุฑูู | ุฅูุบุงุก ุงูุตุฑู + ุงูุงูุชูุงู ูู `RETURN_HOME` |

**ุงูุชุญูู/ุงูุฃูุงู:**
- ูุง ูุชู ุงูุตุฑู ุจุฏูู ุชุญูู ูุงุฌุญ
- ุชุณุฌูู ุงูุณุจุจ ูู ุงูุณุฌูุงุช

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- `face_verified = True` โ `DISPENSE`
- `face_verified = False` โ `RETURN_HOME` (ุจุฏูู ุตุฑู)

---

## ๐น ุงููุฑุญูุฉ 6: DISPENSE (ุตุฑู ุงูุฏูุงุก)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- ุชู ุงูุชุญูู ุฃู ุงูุชุญูู ูุนุทูู
- ุฌููุน ุงูุดุฑูุท ูุณุชููุงุฉ

**ุงูุดุฑุท ููุฏุฎูู:**
- ูุฌุงุญ ุงูุชุญูู ูู ุงููุฌู (ุฃู ุชุฎุทูู)

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ (ุจุงูุชุชุงุจุน):**

### 6.1 Pre-Dispense Check
- ุงูุชุญูู ูู ูุฌูุฏ `box_id` ูู `BOX_CONFIG`
- ุงูุชุญูู ูู ุฌุงูุฒูุฉ `gate_pwm`
- ุทุจุงุนุฉ ูุนูููุงุช ุงูุฒูุงูุง

### 6.2 ุชุฏููุฑ ุงููุงุฑูุณูู
- **ุฅุฐุง** `current_carousel_angle != target_angle`:
  - `smooth_move(pwm_carousel, current, target, steps=40)`
  - ุงูุชุธุงุฑ `0.3` ุซุงููุฉ ููุชุซุจูุช
  - ุชุญุฏูุซ `current_carousel_angle`
- **ุฅูุง**: ุงููุงุฑูุณูู ูู ุงูููุถุน

### 6.3 ุชุฃููุฏ ุงูููุถุน
- **ุชุญูู:** `current_carousel_angle == target_angle`
- **ุฅุฐุง ูุดู:** ุฅูุบุงุก ุงูุตุฑู + ุฎุฑูุฌ

### 6.4 ูุชุญ ุงูุจูุงุจุฉ
- `smooth_move(gate_pwm, close_angle, open_angle, steps=25)`
- ุญุฑูุฉ ุณูุณุฉ ุจุฏูู ุงูุชุฒุงุฒ

### 6.5 ุงูุชุธุงุฑ ุณููุท ุงูุฏูุงุก
- `time.sleep(DISPENSE_HOLD_TIME)` (3 ุซูุงูู)

### 6.6 ุฅุบูุงู ุงูุจูุงุจุฉ
- `smooth_move(gate_pwm, open_angle, close_angle, steps=25)`

### 6.7 ุชุณุฌูู ุงูุนูููุฉ
- `log_dose(box_id, 'dispensed', 'success', ...)`

### 6.8 ุฅููุงู PWM
- `gate_pwm.ChangeDutyCycle(0)`

**ุงูุฃูุงูุฑ ุงููููุงููููุฉ:**
| ุงูุฃูุฑ | ุงููุตู |
|-------|-------|
| `smooth_move(carousel, 0ยฐ, 90ยฐ)` | ุชุฏููุฑ ุงููุงุฑูุณูู |
| `smooth_move(gate, 0ยฐ, 90ยฐ)` | ูุชุญ ุงูุจูุงุจุฉ |
| `time.sleep(3)` | ุงูุชุธุงุฑ ุงูุณููุท |
| `smooth_move(gate, 90ยฐ, 0ยฐ)` | ุฅุบูุงู ุงูุจูุงุจุฉ |
| `ChangeDutyCycle(0)` | ุฅููุงู PWM |

**ุงูุชุญูู/ุงูุฃูุงู:**
- **ุนูุฏ ุงูุฎุทุฃ:** ุฅุบูุงู ุงูุจูุงุจุฉ ุชููุงุฆูุงู
- ุชุณุฌูู ุงููุดู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- ุงูุชูุงุก ุนูููุฉ ุงูุตุฑู (ูุฌุงุญ ุฃู ูุดู)

---

## ๐น ุงููุฑุญูุฉ 7: CAROUSEL_ZERO (ุฅุนุงุฏุฉ ุงููุงุฑูุณูู ููุตูุฑ)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- ุชู ุงูุตุฑู ุฃู ูุญุงููุฉ ุงูุตุฑู

**ุงูุดุฑุท ููุฏุฎูู:**
- ุงูุชูุงุก ุนูููุฉ ุงูุตุฑู

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
1. **ุฅุฐุง** `current_carousel_angle != 0`:
   - `smooth_move(pwm_carousel, current, 0, steps=40)`
   - ุชุญุฏูุซ `current_carousel_angle = 0`
2. ุงูุชุธุงุฑ ุชุซุจูุช `0.3` ุซุงููุฉ
3. `pwm_carousel.ChangeDutyCycle(0)`

**ุงูุฃูุงูุฑ ุงููููุงููููุฉ:**
- `smooth_move(carousel, currentยฐ, 0ยฐ)`
- `ChangeDutyCycle(0)`

**ุงูุชุญูู/ุงูุฃูุงู:**
- ุชุฃููุฏ ุงููุตูู ููุฒุงููุฉ ุตูุฑ

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- `current_carousel_angle == 0`

---

## ๐น ุงููุฑุญูุฉ 8: RETURN_HOME (ุงูุนูุฏุฉ ูููููุน ุงูุฃุตูู)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- ุงููุงุฑูุณูู ูู ุงูุตูุฑ
- ุงูุจูุงุจุฉ ูุบููุฉ

**ุงูุดุฑุท ููุฏุฎูู:**
- ุงูุชูุงุก ุฅุนุงุฏุฉ ุงููุงุฑูุณูู
- ุฃู ูุดู ุงูุชุญูู ูู ุงููุฌู

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
1. ุฅุฑุณุงู ุฃูุฑ `RETURN` ููู Arduino
2. ุชุญุฑูู ุงูุฑูุจูุช ููุฎูู
3. ุงูุชุธุงุฑ `ROBOT_BACKWARD_TIME = 5` ุซูุงูู
4. ุฅุฑุณุงู ุฃูุฑ `STOP`

**ุงูุฃูุงูุฑ ุงููููุงููููุฉ:**
- `serial.write("RETURN\n")` โ ุชุดุบูู ุงููุญุฑูุงุช ููุฎูู
- `serial.write("STOP\n")` โ ุฅููุงู ุงููุญุฑูุงุช

**ุงูุชุญูู/ุงูุฃูุงู:**
- Arduino ูุฑุงูุจ ุงูุนูุงุฆู ุฃุซูุงุก ุงูุฑุฌูุน

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- ุงูุชูุงุก `ROBOT_BACKWARD_TIME`

---

## ๐น ุงููุฑุญูุฉ 9: POST_DISPENSE (ูุง ุจุนุฏ ุงูุตุฑู)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- ุงูุฑูุจูุช ุนุงุฏ ููููุนู

**ุงูุดุฑุท ููุฏุฎูู:**
- ุงูุชูุงุก ุญุฑูุฉ ุงูุฑุฌูุน

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
1. ุฅููุงู ุงููุงููุฑุง: `camera.stop()`
2. ุชุณุฌูู `last_dispensed[box_id] = current_date_key`
3. ุชุณุฌูู ุงูุญุฏุซ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
4. ุทุจุงุนุฉ ููุฎุต ุงูุนูููุฉ

**ุงูุชุญูู/ุงูุฃูุงู:**
- ุชุฃููุฏ ุฅููุงู ุฌููุน ุงููุญุฏุงุช

**ุงูุดุฑุท ููุงูุชูุงู ูููุฑุญูุฉ ุงูุชุงููุฉ:**
- ุงูุชูุงุก ุฌููุน ุงูุฅุฌุฑุงุกุงุช

---

## ๐น ุงููุฑุญูุฉ 10: IDLE (ุงูุนูุฏุฉ ููุงูุชุธุงุฑ)

**ุงูุญุงูุฉ ุงูุจุฑูุฌูุฉ:**
- `robot_state = IDLE`
- ุฌููุน ุงููุญุฏุงุช ูุชูููุฉ

**ุงูุดุฑุท ููุฏุฎูู:**
- ุงูุชูุงุก ูุฑุญูุฉ POST_DISPENSE

**ุงูุฅุฌุฑุงุกุงุช ุงููููุฐุฉ:**
- ุงูุนูุฏุฉ ูุญููุฉ `scheduler_loop`
- ุงูุชุธุงุฑ ุงูููุนุฏ ุงูุชุงูู

**ุงูุชุญูู/ุงูุฃูุงู:**
- ุงููุธุงู ุฌุงูุฒ ูุนูููุฉ ุฌุฏูุฏุฉ

---

## ๐ ูุฎุทุท ุงูุชูุงู ุงูุญุงูุงุช (State Diagram)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                                                                  โ
โ  โโโโโโโโโโโ                                                     โ
โ  โ  IDLE   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โโโโโโฌโโโโโ                                                   โ โ
โ       โ T-60s                                                  โ โ
โ       โผ                                                        โ โ
โ  โโโโโโโโโโโโโโโโโโโ                                           โ โ
โ  โ CAMERA_WARMUP   โ                                           โ โ
โ  โโโโโโโโโโฌโโโโโโโโโ                                           โ โ
โ           โ T-30s                                              โ โ
โ           โผ                                                    โ โ
โ  โโโโโโโโโโโโโโโโโโโ                                           โ โ
โ  โ   PRE_NOTIFY    โ                                           โ โ
โ  โโโโโโโโโโฌโโโโโโโโโ                                           โ โ
โ           โ T=0                                                โ โ
โ           โผ                                                    โ โ
โ  โโโโโโโโโโโโโโโโโโโ                                           โ โ
โ  โ  MOVE_FORWARD   โ                                           โ โ
โ  โโโโโโโโโโฌโโโโโโโโโ                                           โ โ
โ           โ 8s                                                 โ โ
โ           โผ                                                    โ โ
โ  โโโโโโโโโโโโโโโโโโโ                                           โ โ
โ  โARRIVED_AT_PATIENTโ                                          โ โ
โ  โโโโโโโโโโฌโโโโโโโโโ                                           โ โ
โ           โ                                                    โ โ
โ     โโโโโโโดโโโโโโ                                              โ โ
โ     โauth_enabled?โ                                            โ โ
โ     โโโโโโโฌโโโโโโ                                              โ โ
โ      YES  โ   NO                                               โ โ
โ     โโโโโโโดโโโโโโ                                              โ โ
โ     โผ           โผ                                              โ โ
โ โโโโโโโโโโโโโ โโโโโโโโโโโ                                      โ โ
โ โVERIFY_FACEโ โ         โ                                      โ โ
โ โโโโโโโฌโโโโโโ โ         โ                                      โ โ
โ       โ       โ         โ                                      โ โ
โ  โโโโโโดโโโโโ  โ         โ                                      โ โ
โ  โsuccess? โ  โ         โ                                      โ โ
โ  โโโโโโฌโโโโโ  โ         โ                                      โ โ
โ  YES  โ  NO   โ         โ                                      โ โ
โ   โโโโโ  โโโโโโผโโโโโโโโโโผโโโโโโโโโโ                            โ โ
โ   โผ           โผ         โ         โ                            โ โ
โ โโโโโโโโโโโ              โ         โ                            โ โ
โ โ DISPENSE โโโโโโโโโโโโโโโ         โ                            โ โ
โ โโโโโโฌโโโโโ                        โ                            โ โ
โ      โ                             โ                            โ โ
โ      โผ                             โ                            โ โ
โ โโโโโโโโโโโโโโโ                    โ                            โ โ
โ โCAROUSEL_ZEROโ                    โ                            โ โ
โ โโโโโโโโฌโโโโโโโ                    โ                            โ โ
โ        โ                           โ                            โ โ
โ        โผ                           โผ                            โ โ
โ โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ                            โ โ
โ โ RETURN_HOME โ                                                 โ โ
โ โโโโโโโโฌโโโโโโโ                                                 โ โ
โ        โ                                                        โ โ
โ        โผ                                                        โ โ
โ โโโโโโโโโโโโโโโโ                                                โ โ
โ โ POST_DISPENSEโ                                                โ โ
โ โโโโโโโโฌโโโโโโโโ                                                โ โ
โ        โ                                                        โ โ
โ        โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ ุชูุงุนู ุงููุญุฏุงุช

| ุงููุญุฏุฉ | ุงูุฏูุฑ | ุงูุชูุงุนู |
|--------|-------|---------|
| **Scheduler** | ูุฑุงูุจุฉ ุงูููุช | ูุทูู `full_dispense_sequence` |
| **Hardware** | ุชุญูู GPIO | ูููุฐ ุฃูุงูุฑ ุงูุณูุฑูู ูุงููุญุฑูุงุช |
| **Camera** | ุงูุชุตููุฑ | ุชุดุบูู/ุฅููุงู ุญุณุจ ุงูุญุงุฌุฉ |
| **Face Engine** | ุงูุชุนุฑู | ูููุฑ `get_last_face()` |
| **Audio** | ุงูุฃุตูุงุช | ูุดุบู ุงูุชูุจููุงุช |
| **Database** | ุงูุชุณุฌูู | ูุญูุธ ุงูุณุฌูุงุช |

---

## โ๏ธ ุณููุงุฑูููุงุช ุงููุดู ูุงูุงุณุชุฑุฏุงุฏ

| ุงูุณููุงุฑูู | ุงูุฅุฌุฑุงุก |
|-----------|---------|
| ูุดู ุชุดุบูู ุงููุงููุฑุง | ุชุณุฌูู ุงูุฎุทุฃ + ูุชุงุจุนุฉ (optional) |
| ูุดู ุงูุชุญูู ูู ุงููุฌู | ุฅูุบุงุก ุงูุตุฑู + ุฑุฌูุน ุงูุฑูุจูุช |
| Timeout ุงูุชุญูู (15s) | ุฅูุบุงุก ุงูุตุฑู + ุฑุฌูุน ุงูุฑูุจูุช |
| ูุดู ุชุฏููุฑ ุงููุงุฑูุณูู | ุฅูุบุงุก ุงูุตุฑู + ุชุณุฌูู ุงูุฎุทุฃ |
| ุฎุทุฃ ุฃุซูุงุก ุงูุตุฑู | ุฅุบูุงู ุงูุจูุงุจุฉ ููุณูุงูุฉ + ุชุณุฌูู |
| ุนุงุฆู ุฃุซูุงุก ุงูุญุฑูุฉ | ุชููู Arduino ุชููุงุฆูุงู |

---

## ๐ ููุงุนุฏ ุงูุณูุงูุฉ

1. **ูุง ุตุฑู ุจุฏูู ุชุญูู** (ุฅุฐุง ููุนูู)
2. **ูุง ุญุฑูุงุช ูุชุฏุงุฎูุฉ** - ุชุณูุณู ุตุงุฑู
3. **Fail-Safe** - ุฅุบูุงู ุงูุจูุงุจุฉ ุฏุงุฆูุงู ุนูุฏ ุงูุฎุทุฃ
4. **ุฅููุงู PWM** - ุจุนุฏ ูู ุนูููุฉ ุณูุฑูู
5. **ุชุณุฌูู ูู ุดูุก** - ูุฌุงุญ ููุดู

---

**ููุงูุฉ ุงููุซููุฉ**
