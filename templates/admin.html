<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEDIBOT OS | ููุญุฉ ุงูุชุญูู</title>
    <link rel="icon"
        href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%236366f1' rx='20' width='100' height='100'/><text x='50' y='68' font-size='50' text-anchor='middle' fill='white'>๐</text></svg>">

    <!-- External CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
</head>

<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="brand-logo">๐</div>
            <nav class="nav-menu">
                <a href="/" class="nav-item active" title="ุงูุฑุฆูุณูุฉ">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"></rect>
                        <rect x="14" y="3" width="7" height="7"></rect>
                        <rect x="14" y="14" width="7" height="7"></rect>
                        <rect x="3" y="14" width="7" height="7"></rect>
                    </svg>
                </a>
                <a href="/patient" class="nav-item" title="ุดุงุดุฉ ุงููุฑูุถ">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                </a>
                <a href="/enroll" class="nav-item" title="ุชุณุฌูู ูุฌูู ุฌุฏูุฏุฉ" style="display: flex !important;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                        <line x1="12" y1="11" x2="12" y2="17"></line>
                        <line x1="9" y1="14" x2="15" y2="14"></line>
                    </svg>
                </a>
                <a href="/statistics" class="nav-item" title="ุงูุฅุญุตุงุฆูุงุช">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="20" x2="18" y2="10"></line>
                        <line x1="12" y1="20" x2="12" y2="4"></line>
                        <line x1="6" y1="20" x2="6" y2="14"></line>
                    </svg>
                </a>
            </nav>
            <div class="nav-bottom">
                <div class="nav-item" onclick="toggleTheme()" title="ุชุบููุฑ ุงููุถุน">
                    <span id="theme-icon">๐</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <div class="header-title">
                    <h1>ููุญุฉ ุงูุชุญูู </h1>
                    <p>ูุดุฑูุน ุงูุฑูุจูุช ุงูุฐูู ูุชูุฒูุน ุงูุฃุฏููุฉ - MEDI BOX</p>
                </div>
                <div class="header-actions">
                    <a href="/enroll" class="icon-btn" title="ุชุณุฌูู ูุฌูู ุฌุฏูุฏุฉ">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                            <line x1="12" y1="11" x2="12" y2="17"></line>
                            <line x1="9" y1="14" x2="15" y2="14"></line>
                        </svg>
                    </a>
                    <button class="icon-btn" onclick="toggleRobot()" id="robot-toggle-btn" title="ุชุดุบูู/ุฅููุงู ุงูุฑูุจูุช">
                        <svg viewBox="0 0 24 24" width="24" height="24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path
                                d="M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2z">
                            </path>
                        </svg>
                    </button>
                </div>
            </header>

            <div class="bento-grid">
                <!-- Status Card -->
                <div class="card status-card">
                    <div class="card-header">
                        <span class="card-title">โก ุญุงูุฉ ุงููุธุงู</span>
                        <div class="status-pill">
                            <span class="status-dot"></span>
                            <span id="status-text">ูุดุท</span>
                        </div>
                    </div>
                    <div class="status-content">
                        <div class="status-info">
                            <h2 id="clock-main">00:00:00</h2>
                            <p style="color: var(--text-muted); margin-bottom: 20px;" id="date-display">ุงูุชุงุฑูุฎ</p>
                            <div style="display: flex; gap: 15px;">
                                <div
                                    style="background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 12px;">
                                    <span
                                        style="display:block; font-size: 0.75rem; color: var(--text-muted);">ุงูุฌุฏุงูู</span>
                                    <span style="font-weight: 700; color: var(--success);" id="active-count">0</span>
                                </div>
                                <div
                                    style="background: rgba(255,255,255,0.05); padding: 10px 15px; border-radius: 12px;">
                                    <span
                                        style="display:block; font-size: 0.75rem; color: var(--text-muted);">ุงูุญุงูุฉ</span>
                                    <span style="font-weight: 700; color: var(--primary);">ูุชุตู</span>
                                </div>
                            </div>
                        </div>
                        <div class="robot-visual">
                            <div class="robot-circle"></div>
                            <div class="robot-circle"></div>
                            <div class="robot-circle"></div>
                            <div class="robot-icon">๐ค</div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="card actions-card">
                    <div class="action-btn" onclick="loadMode()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        <span>ุชุญููู ุงูุฏูุงุก ุตูุฏูู 2</span>
                    </div>
                    <div class="action-btn" onclick="goZero()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                            <path d="M21 3v5h-5"></path>
                            <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                        </svg>
                        <span>ุชุญููู ุงูุฏูุงุก ุตูุฏูู 1</span>
                    </div>
                    <div class="action-btn" id="robot-toggle-btn" onclick="toggleRobot()"
                        style="border-color: rgba(16, 185, 129, 0.3);">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#10b981" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"></polygon>
                        </svg>
                        <span id="robot-toggle-text" style="color: #10b981;">ุชุดุบูู ุงูุฑูุจูุช</span>
                    </div>
                    <div class="action-btn" style="border-color: rgba(239, 68, 68, 0.3);" onclick="emergencyStop()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#ef4444" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        </svg>
                        <span style="color: #ef4444;">ุทูุงุฑุฆ</span>
                    </div>
                </div>

                <!-- Settings Card -->
                <div class="card settings-card" style="grid-column: span 12;">
                    <div class="card-header">
                        <div class="card-title">
                            <span>โ๏ธ ุฅุนุฏุงุฏุงุช ุงููุธุงู</span>
                        </div>
                    </div>

                    <div
                        style="display: flex; align-items: center; justify-content: space-between; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 12px; border: 1px solid var(--border-color);">
                        <div style="display:flex; gap: 15px; align-items:center;">
                            <div style="font-size: 2rem;">๐ธ</div>
                            <div>
                                <h3 style="margin-bottom: 5px; color: var(--text-main);">ูุธุงู ุงูุชุนุฑู ุนูู ุงููุฌู</h3>
                                <p style="color: var(--text-muted); font-size: 0.9rem; margin:0;">ุชูุนูู ุงููุงููุฑุง ูุงูุชุญูู
                                    ูู ุงููููุฉ ูุจู ูุชุญ ุงูุตูุงุฏูู</p>
                            </div>
                        </div>

                        <label class="switch" for="auth-toggle">
                            <input type="checkbox" id="auth-toggle" onchange="toggleAuthSettings()" aria-label="ุชูุนูู ูุธุงู ุงูุชุนุฑู ุนูู ุงููุฌู">
                            <span class="slider round"></span>
                        </label>
                    </div>

                    <!-- Enrollment Link -->
                    <div
                        style="margin-top: 15px; padding: 15px; background: rgba(0,0,0,0.2); border-radius: 12px; border: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center;">
                        <div style="display:flex; gap: 15px; align-items:center;">
                            <div style="font-size: 2rem;">๐ค</div>
                            <div>
                                <h3 style="margin-bottom: 5px; color: var(--text-main);">ุชุณุฌูู ูุฌูู ุฌุฏูุฏุฉ</h3>
                                <p style="color: var(--text-muted); font-size: 0.9rem; margin:0;">ุฅุถุงูุฉ ูุฑุถู ุฌุฏุฏ ุฅูู
                                    ูุงุนุฏุฉ ุงูุจูุงูุงุช</p>
                            </div>
                        </div>
                        <a href="/enroll" class="action-btn"
                            style="background: var(--primary); color: white; border: none; text-decoration: none;">
                            <span>ูุชุญ ุตูุญุฉ ุงูุชุณุฌูู โ</span>
                        </a>
                    </div>
                </div>

                <!-- Schedule Cards (Dynamic Loop) -->
                {% for box_id in boxes %}
                <div class="card schedule-card">
                    <div class="card-header">
                        <span class="card-title">
                            <span
                                class="status-dot-dynamic {% if box_id % 2 != 0 %}dot-primary{% else %}dot-secondary{% endif %}"
                                style="width: 8px; height: 8px; border-radius: 50%;"></span>
                            ุงูุตูุฏูู {{ box_id }}
                        </span>
                        <button class="icon-btn" style="width: 32px; height: 32px;" onclick="openBox('{{ box_id }}')"
                            title="ูุชุญ">๐</button>
                    </div>

                    <div class="input-group">
                        <label class="input-label">ุงุณู ุงูุฏูุงุก</label>
                        <input type="text" id="box{{ box_id }}-name" class="modern-input" placeholder="ุฃุฏุฎู ุงูุงุณู"
                            value="ุงูุฌุฑุนุฉ {{ box_id }}">
                    </div>

                    <!-- ุฅุนุฏุงุฏุงุช ุงููุฎุฒูู -->
                    <div style="background: rgba(0,0,0,0.2); padding: 15px; border-radius: 12px; margin-bottom: 20px;">
                        <h4 class="{% if box_id % 2 != 0 %}header-accent-primary{% else %}header-accent-secondary{% endif %}"
                            style="margin-bottom: 10px; font-size: 0.9rem;">
                            ๐ ุฅุฏุงุฑุฉ ุงููุฎุฒูู</h4>

                        <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <label class="input-label">ุงููุฎุฒูู ุงูุญุงูู</label>
                                <input type="number" id="box{{ box_id }}-stock" class="modern-input" min="0" value="0">
                            </div>
                            <div style="flex: 1;">
                                <label class="input-label">ุงูุฌุฑุนุฉ ููู ุตุฑู</label>
                                <input type="number" id="box{{ box_id }}-dose" class="modern-input" min="1" value="1">
                            </div>
                        </div>

                        <div style="display: flex; gap: 10px;">
                            <div style="flex: 1;">
                                <label class="input-label">ุญุฏ ุงูุชูุจูู</label>
                                <input type="number" id="box{{ box_id }}-threshold" class="modern-input" min="1"
                                    value="5">
                            </div>
                            <div style="flex: 1;">
                                <label class="input-label">ุฑุงุจุท ุงูุตูุฏููุฉ</label>
                                <input type="text" id="box{{ box_id }}-pharmacy" class="modern-input"
                                    value="https://kuludonline.com/">
                            </div>
                        </div>

                        <!-- ุชูุจูู ุงููุฎุฒูู -->
                        <div id="stock-warning-{{ box_id }}"
                            style="display: none; background: rgba(239, 68, 68, 0.2); border: 1px solid var(--danger); padding: 10px; border-radius: 8px; margin-top: 10px; align-items: center; gap: 10px;">
                            <span style="color: var(--danger); font-size: 0.9rem; font-weight: bold;">โ๏ธ ุงูุชุจู: ุงููุฎุฒูู
                                ููุฎูุถ!</span>
                            <a href="#" id="pharmacy-link-{{ box_id }}" target="_blank"
                                style="margin-right: auto; background: var(--danger); color: white; padding: 6px 14px; border-radius: 6px; text-decoration: none; font-size: 0.8rem; transition: 0.2s;">ุดุฑุงุก
                                ุงูุฏูุงุก ๐</a>
                        </div>
                    </div>

                    <div class="day-selector" id="days-box{{ box_id }}">
                        <div class="day-chip" data-day="0">ุฃุญุฏ</div>
                        <div class="day-chip" data-day="1">ุฅุซููู</div>
                        <div class="day-chip" data-day="2">ุซูุงุซุงุก</div>
                        <div class="day-chip" data-day="3">ุฃุฑุจุนุงุก</div>
                        <div class="day-chip" data-day="4">ุฎููุณ</div>
                        <div class="day-chip" data-day="5">ุฌูุนุฉ</div>
                        <div class="day-chip" data-day="6">ุณุจุช</div>
                    </div>
                    <div class="time-row">
                        <div class="time-input-wrapper"><input type="number" id="box{{ box_id }}-hours" min="0" max="23"
                                value="08" aria-label="ุงูุณุงุนุฉ"></div>
                        <span class="time-separator">:</span>
                        <div class="time-input-wrapper"><input type="number" id="box{{ box_id }}-minutes" min="0"
                                max="59" value="00" aria-label="ุงูุฏูููุฉ"></div>
                    </div>
                    <button onclick="setTimer('{{ box_id }}')"
                        class="btn-large {% if box_id % 2 != 0 %}btn-primary{% else %}btn-secondary{% endif %}">โฐ ุญูุธ
                        ูุชูุนูู</button>
                    <div id="timer-display-{{ box_id }}" class="countdown-display">ุงูุชุงูู: <span
                            id="countdown-{{ box_id }}">--:--:--</span>
                    </div>
                </div>
                {% endfor %}

                <!-- Logs -->
                <div class="card logs-card">
                    <div class="logs-header">
                        <span>SYSTEM_LOG</span>
                        <span>โ ูุชุตู</span>
                    </div>
                    <div class="logs-body" id="terminal-output">
                        <div class="log-entry"><span class="log-time">00:00:00</span> > ุงููุธุงู ุฌุงูุฒ...</div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="footer-branding">
                    <span>ูุฏุฑุณุฉ ุนุจุฏุงููู ุจู ุนูู ุงููุณูุฏ ุงูุซุงูููุฉ ููุจููู</span> โข ูุดุฑูุน ุงูุฑูุจูุช ุงูุฐูู ูุชูุฒูุน ุงูุฃุฏููุฉ โข ุนูู
                    ุงูุทูุงุจ:
                    ูุญูุฏ ูููุฏ
                    ุนูุงุฑุฉ & ุนุจุฏ ุงููู
                    ุฎุงูุฏ ุงููุนููู <span class="sep">|</span> ุฅุดุฑุงู: ูุดุงู ุนุจุฏ ุงูุฑุญูุงู ุณุงููู
                </div>
            </div>
        </main>
    </div>

    <!-- External JS -->
    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>

</html>